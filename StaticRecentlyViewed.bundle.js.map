{"version":3,"sources":["webpack:///./source/scripts/sections/StaticRecentlyViewed.js"],"names":["StaticRecentlyViewed","section","namespace","maxRecentlyViewed","maxStorageTime","version","storageKey","$el","$","el","time","data","flickity","recentlyViewed","recently_viewed_info","cardSettings","product_card_settings","timestamp","Math","round","Date","getTime","slideImageLoaded","_onSlideImageLoaded","bind","_getRecentlyViewed","removeRecentlyViewed","handle","push","promises","_setRecentlyViewed","when","done","length","cardsMarkup","_getRecentlyViewedCards","cardsData","find","append","forEach","productData","timeSince","prepend","rimg","watch","$carousel","slides","_initSlider","addClass","bindEvents","on","event","$target","currentTarget","closest","parents","nextAll","setTimeout","index","removeClass","remove","selectCell","clearRecentlyViewed","now","secondsPast","secondsAgo","parseInt","second","ago","seconds","minutesAgo","minute","minutes","hoursAgo","hour","hours","date","currentDate","day","getDate","month","toDateString","match","replace","year","getFullYear","i","splice","cards","sessionStorage","getItem","JSON","parse","setItem","stringify","removeEventListener","localStorage","removeItem","resize","flickityOptions","autoPlay","accessibility","cellAlign","cellSelector","groupCells","pageDots","contain","arrowShape","x0","x1","y1","x2","y2","x3","Flickity","addEventListener","floor","minStorageTimestamp","filteredData","filter","item","removeCount","error","console","warn","handles","map","x","storedCards","Object","keys","key","fetchUrl","get","catch","then","response","orderedItems","markup","cardKey","domParser","DOMParser","card","parseFromString","querySelector","join"],"mappings":"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","file":"StaticRecentlyViewed.bundle.js","sourcesContent":["import $ from 'jquery';\nimport Flickity from 'flickity';\nimport rimg from 'rimg-shopify';\n\nexport default class StaticRecentlyViewed {\n  constructor(section) {\n    this.namespace = 'pxu';\n    this.maxRecentlyViewed = 30; // Store a max of 30 items\n    this.maxStorageTime = 30 * 24 * 3600; // Store items for 30 days only\n    this.version = 1; // Version key is used to update localstorage when format changes\n    this.storageKey = `${this.namespace}-recentlyViewed-${this.version}`;\n    this.$el = $(section.el);\n    this.time = section.data.time;\n    this.flickity = null;\n\n    this.recentlyViewed = section.data.recently_viewed_info;\n    this.cardSettings = section.data.product_card_settings;\n\n    if (this.recentlyViewed && this.time) {\n      this.recentlyViewed.timestamp = Math.round((new Date()).getTime() / 1000);\n    }\n\n    this.slideImageLoaded = this._onSlideImageLoaded.bind(this);\n\n    let recentlyViewed = [];\n\n    if (this.time) {\n      recentlyViewed = this._getRecentlyViewed();\n      if (this.recentlyViewed) {\n        this.removeRecentlyViewed(this.recentlyViewed.handle, recentlyViewed);\n\n\n        recentlyViewed.push(this.recentlyViewed);\n      }\n\n      const promises = this._setRecentlyViewed(recentlyViewed);\n\n      // Wait until promises are resolved before inserting markup into the DOM\n      $.when(...promises).done(() => {\n        if (recentlyViewed.length) {\n          const cardsMarkup = this._getRecentlyViewedCards();\n          const cardsData = this._getRecentlyViewed();\n          this.$el.find('[data-recently-viewed-container]').append(cardsMarkup);\n\n          cardsData.forEach(productData => {\n            const timestamp = this.timeSince(productData.timestamp);\n            $(`[data-product-handle=${productData.handle}]`)\n              .prepend(timestamp);\n          });\n\n          rimg.watch(this.$el[0]);\n          this.$carousel = this.$el.find('.product-recently-viewed--content');\n          this.slides = '.product-recently-viewed-card';\n\n          if (this.$carousel.find(this.slides).length > 1) {\n            this._initSlider();\n          }\n        } else {\n          this.$el.find('.product-recently-viewed--section').addClass('hide');\n        }\n      });\n    } else {\n      if (this.recentlyViewed) {\n        recentlyViewed.push(this.recentlyViewed);\n        this._setRecentlyViewed(recentlyViewed);\n      }\n\n      this.$el.find('.product-recently-viewed--section').addClass('hide');\n    }\n\n    this.bindEvents();\n  }\n\n  bindEvents() {\n    this.$el.on('click', '[data-remove-recently-viewed]', event => {\n      const $target = $(event.currentTarget);\n      const handle = $target.closest('[data-product-handle]').data('product-handle');\n      const recentlyViewed = this._getRecentlyViewed();\n\n      this.removeRecentlyViewed(handle, recentlyViewed);\n      this._setRecentlyViewed(recentlyViewed);\n\n      $target.parents('[data-recently-viewed-card]').addClass('hide-card');\n      $target.parents('[data-recently-viewed-card]').nextAll().addClass('move-card');\n\n      setTimeout(() => {\n        let index = $target.parents('[data-recently-viewed-card]').index();\n        if (index !== 0) {\n          index--;\n        }\n\n        $target.parents('[data-recently-viewed-card]').nextAll().removeClass('move-card');\n        if ($target.parents('[data-recently-viewed-card]').length) {\n          this.flickity.remove($target.parents('[data-recently-viewed-card]'));\n        }\n        this.flickity.selectCell(index);\n      }, 500);\n    });\n\n    this.$el.on('click', '[data-clear-recently-viewed]', () => {\n      this.clearRecentlyViewed();\n    });\n  }\n\n  timeSince(timestamp) {\n    const now = Math.round((new Date()).getTime() / 1000);\n    const secondsPast = now - timestamp;\n\n    if (secondsPast < 60) {\n      const secondsAgo = parseInt(secondsPast, 10);\n\n      return secondsAgo === 1\n        ? `${secondsAgo} ${this.time.second} ${this.time.ago}`\n        : `${secondsAgo} ${this.time.seconds} ${this.time.ago}`;\n    }\n\n    if (secondsPast < 3600) {\n      const minutesAgo = parseInt(secondsPast / 60, 10);\n\n      return minutesAgo === 1\n        ? `${minutesAgo} ${this.time.minute} ${this.time.ago}`\n        : `${minutesAgo} ${this.time.minutes} ${this.time.ago}`;\n    }\n\n    if (secondsPast <= 86400) {\n      const hoursAgo = parseInt(secondsPast / 3600, 10);\n\n      return hoursAgo === 1\n        ? `${hoursAgo} ${this.time.hour} ${this.time.ago}`\n        : `${hoursAgo} ${this.time.hours} ${this.time.ago}`;\n    }\n\n    const date = new Date(timestamp * 1000);\n    const currentDate = new Date(now * 1000);\n    const day = date.getDate();\n    const month = date.toDateString().match(/ [a-zA-Z]*/)[0].replace(' ', '');\n    const year = date.getFullYear() === currentDate.getFullYear()\n      ? ''\n      : `, ${date.getFullYear()}`;\n\n    return `${month} ${day} ${year}`;\n  }\n\n  removeRecentlyViewed(handle, recentlyViewed) {\n    for (let i = 0; i < recentlyViewed.length; i++) {\n      if (recentlyViewed[i].handle === handle) {\n        recentlyViewed.splice(i, 1);\n      }\n    }\n    this._setRecentlyViewed(recentlyViewed);\n    const cards = sessionStorage.getItem(this.storageKey)\n      ? JSON.parse(sessionStorage.getItem(this.storageKey))\n      : {};\n\n    delete cards[handle];\n\n    sessionStorage.setItem(this.storageKey, JSON.stringify(cards));\n\n    if (recentlyViewed.length === 0) {\n      this.$el.find('.product-recently-viewed--section').addClass('hide');\n    }\n\n    if (this.$carousel) {\n      this.$carousel[0].removeEventListener('rimg:load', this.slideImageLoaded);\n    }\n  }\n\n  clearRecentlyViewed() {\n    localStorage.removeItem(this.storageKey);\n    sessionStorage.removeItem(this.storageKey);\n    this.$el.find('[data-recently-viewed-card]').remove();\n    this.$el.find('.product-recently-viewed--section').addClass('hide');\n  }\n\n  _onSlideImageLoaded() {\n    this.flickity.resize();\n  }\n\n  _initSlider() {\n    this.flickityOptions = {\n      autoPlay: 0,\n      accessibility: true,\n      cellAlign: 'left',\n      cellSelector: this.slides,\n      groupCells: true,\n      pageDots: false,\n      contain: true,\n      arrowShape: {\n        x0: 10,\n        x1: 60,\n        y1: 50,\n        x2: 65,\n        y2: 45,\n        x3: 20,\n      },\n    };\n\n    this.flickity = new Flickity(this.$carousel[0], this.flickityOptions);\n\n    this.$carousel[0].addEventListener('rimg:load', this.slideImageLoaded);\n  }\n\n  /**\n   * Store recently viewed products\n   *\n   * @param {Object[]} productData - recently viewed products\n   * @param {number} productData[].timestamp - indicating when product was added to productData\n   * @param {string} productData[].handle - Shopify product handle\n   * @private\n   */\n  _setRecentlyViewed(productData) {\n    const now = Math.floor(Date.now() / 1000); // Unix timestamp for current date\n    const minStorageTimestamp = now - this.maxStorageTime;\n    const filteredData = productData.filter(item => item.timestamp > minStorageTimestamp);\n\n    if (filteredData.length > this.maxRecentlyViewed) {\n      const removeCount = filteredData.length - this.maxRecentlyViewed;\n      filteredData.splice(0, removeCount); // Remove oldest if more than max number have been stored\n    }\n\n    try {\n      localStorage.setItem(this.storageKey, JSON.stringify(filteredData));\n    } catch (error) {\n      console.warn(error);\n    }\n\n    // Retrieve markup for recently viewed cards and store in session\n    try {\n      const handles = filteredData\n        ? filteredData.map(x => x.handle)\n        : [];\n      let storedCards = sessionStorage.getItem(this.storageKey)\n        ? JSON.parse(sessionStorage.getItem(this.storageKey))\n        : {};\n\n      if (storedCards.cardSettings) {\n        Object.keys(storedCards.cardSettings).forEach(key => {\n          if (storedCards.cardSettings[key] !== this.cardSettings[key]) {\n            storedCards = {};\n            sessionStorage.removeItem(this.storageKey);\n          }\n        });\n      }\n      storedCards.cardSettings = this.cardSettings;\n      const promises = handles.map(handle => {\n        if (storedCards[handle]) {\n          return null;\n        }\n        const fetchUrl = `/products/${handle}?view=_recently-viewed`;\n        return $.get(fetchUrl)\n          .catch(error => console.error('Error:', error))\n          .then(response => {\n            if (response) {\n              storedCards[handle] = response;\n              try {\n                sessionStorage.setItem(this.storageKey, JSON.stringify(storedCards));\n              } catch (error) {\n                console.warn(error);\n              }\n            }\n          });\n      });\n      return promises;\n    } catch (error) {\n      console.warn(error);\n      return false;\n    }\n  }\n\n  /**\n   * Get stored recently viewed products\n   *\n   * @returns {Array}\n   * @private\n   */\n  _getRecentlyViewed() {\n    try {\n      const recentlyViewed = localStorage.getItem(this.storageKey)\n        ? JSON.parse(localStorage.getItem(this.storageKey))\n        : [];\n\n      return recentlyViewed;\n    } catch (error) {\n      console.warn(error);\n      return [];\n    }\n  }\n\n  _getRecentlyViewedCards() {\n    const cards = sessionStorage.getItem(this.storageKey)\n      ? JSON.parse(sessionStorage.getItem(this.storageKey))\n      : {};\n\n    const orderedItems = localStorage.getItem(this.storageKey)\n      ? JSON.parse(localStorage.getItem(this.storageKey))\n      : {};\n\n    const markup = [];\n\n    for (let i = orderedItems.length - 1; i >= 0; i--) {\n      const cardKey = orderedItems[i].handle;\n\n      // When store password is enabled and viewing the product page in preview\n      // mode, product cards for products which have been deleted from the admin\n      // will return the password page. Before inserting the card markup, we\n      // need to check that it contains a product.\n      const domParser = new DOMParser();\n      const card = domParser.parseFromString(cards[cardKey], 'text/html');\n      if (card.querySelector('.productgrid--item')) {\n        markup.push(cards[cardKey]);\n      }\n    }\n\n    return markup.join('');\n  }\n}\n"],"sourceRoot":""}